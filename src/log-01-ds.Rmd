---
title: 'Data Science Log #1'
author: "Rrustem Sallauka"
date: "`r Sys.Date()`"
output:
  html_document:
    df_print: paged
bibliography: references.bib
---
```{r setup}
library(dplyr)
library(tibble)
library(vitae)
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
```

```{r}
library(distill)
library(tidyverse)
```


Install the `palmerpenguins` package and load the `penguins` dataset
into your environment.

```{r}
library(palmerpenguins)
penguins <- penguins
```

    Compute how many female and male species are available for each
    species on each island. What do you notice in the data?
```{r}
penguins %>% group_by(species,island) %>% count(sex)
```
The species Adelie and Gentoo have missing data in the gender column. 
<!-- -->

Change the previous code to resolve the issue and save the dataframe.
```{r}
penguinssex <- penguins %>% na.omit() %>%  group_by(species, island, sex) %>% summarise(count = n())
```

    Create an appropriate visualization to display sex, species and
    island. Note: You need to transform the data first. Label the axes,
    give the graphic a title and make sure that basic visualization
    standards are maintained. Interpret what you see in one sentence
```{r}
ggplot(
  penguinssex, 
  aes(
    x = species,
    y = count,
    fill = sex)) + geom_bar(stat = "identity", position = "dodge") + facet_wrap(~ island) + labs(
    title = "Number of Penguin based on sex, species and island",
    x = "Species",
    y = "Number",
    fill = "Sex"
  ) +
  theme_minimal()
```
There is no island with all species living on it, while the sex is distributed equally.

What is the average body mass of penguins of each species?
```{r}
penguinsmass <- penguins %>% drop_na() %>% 
  group_by(species) %>% summarise(avg_mass = mean(body_mass_g))
```



## Spotify top chart songs 2022 

Download the chart songs dataset from moodle and load it into R. The
data is provided by the data science competition platform
[Kaggle](https://www.kaggle.com/). You can find a detailed description
of all variables in the data on the Kaggle website at
<https://www.kaggle.com/datasets/sveta151/spotify-top-chart-songs-2022>
and a short description below.

    Create a table displaying the top 15 songs in the dataset, including
    the song title, the artists' names, their peak rank and the number
    of weeks in the charts. `knitr::kable()`.
```{r}
spotify_top_charts_22 <- read_csv("data/spotify_top_charts_22.csv")
spotify_top_charts_22 %>%
  head(15) %>%
  select(track_name, artist_names, peak_rank, weeks_on_chart) %>%
  knitr::kable(caption = "A table with the top 15 songs")
```


Add a caption to your table. Who wrote the second most popular song?

    Calculate the percentage of songs written in major modality. Hint:
    Check out the Kaggle website for details about the variables of the
    dataset.
```{r}
mean((spotify_top_charts_22$mode == 1)) 
```

    Create a scatterplot, showing the danceability score of a song on
    the X-axis and the energy score on the Y-axis.
```{r spotify, fig.cap="Danceability and Energy of songs"}
ggplot(
  spotify_top_charts_22,
  aes(
    x = danceability,
    y = energy
  )
) + geom_point() + labs(
  title = "How hard goes the song?",
  subtitle = "danceability and energy of songs",
  x = "Danceability score",
  y = "Energy score"
)
```

    Add an appropriate caption to your figure (as part of the Rmarkdown,
    not within ggplot).

    Write a short sentence describing and interpreting the figure.
    Properly
    [reference](https://bookdown.org/yihui/rmarkdown-cookbook/cross-ref.html)
    the figure in your sentence.

Figure \@ref(fig:spotify) shows a positve correlation of danceability and energy. 

<!-- -->

    Write another sentence describing that the figure was generated
    using `ggplot2` and add a
    [citation](https://bookdown.org/yihui/rmarkdown-cookbook/bibliography.html)
    for `ggplot2`.
    
To create this code we used ggplot2 [@ggplot2]

<!-- -->

    Calculate the correlation between the danceability and the energy
    perception. Write a sentence in Markdown and automatically insert
    the correct number.
```{r}
scorrelation <- cor(spotify_top_charts_22$danceability,spotify_top_charts_22$energy, use = 'complete.obs')
```

The correlation between danceability and the energy is `r scorrelation`

## Spotify top chart songs 2 

    The number of weeks in charts and peak rank alone cannot fully
    reflect a song's popularity: compare a song which was a one hit (aka
    one week) wonder with possibly peak rank 1 and a song ranking 10th
    place but for multiple weeks. Create a new combined
    `popularity_score` metric for songs which is calculated by dividing
    the number of weeks the song has been in the charts by its peak
    rank.

e.g.: Drake:Falling Back(peak rank: 10,weeks in chart: 1) and Imagine Dragons:Believer(peak rank: 16,weeks in chart: 268)

```{r}
spotify_top_charts_22$popularity_score <- spotify_top_charts_22$weeks_on_chart / spotify_top_charts_22$peak_rank
```


    Output a formatted table with the **top 15** songs ordered by this
    popularity score. Include the song title, the artists' names, the
    weeks on chart, the peak rank and the popularity score.

-   Add a caption to the table.
-   Display the popularity score rounded to 3 digits, without rounding
    by hand.

> Tip: Check out the options in `knitr::kable()`

```{r spotify15}
spotify_top_charts_22 %>%
  arrange(desc(popularity_score)) %>% 
  head(15) %>%
  select(track_name,artist_names,weeks_on_chart,peak_rank,popularity_score) %>%
  knitr::kable(caption = "A table with the top 15 songs", digits = 3)
```


    Write one or two sentences describing the table, focusing on a
    comparison of its last two entries in particular. Include a link to
    the two songs and properly
    [reference](https://bookdown.org/yihui/rmarkdown-cookbook/cross-ref.html)
    the table.

In the Table \@ref(tab:spotify15) of the 15 best songs, "[Perfect](https://open.spotify.com/track/0tgVpDi06FyKpA1z0VMD4v) " form Ed Sheeran was more weeks(262) in the charts, but the peak rank was only 4, while "[Heat Waves](https://open.spotify.com/track/02MWAaffLxlfxAUY7c5dvx)" form Glass Animals was fewer weeks(65) in the charts, but had a higher peak ranking with 1, so with 65.5 Ed Sheerans song has a slightly higher populartity score than Glass Animals with 65.0.

> Note: Proper referencing of the table will only work when rendering to
> a PDF. Don't get hung up on this if it provides some problems, as
> dealing with LaTeX can be a bit tricky.

    Add a level-1 heading called `Supplementary Materials` and put the
    following figure under it.

<!-- -->

# Supplementary Materials
    Create a histogram illustrating the danceability of the songs,
    coloured by modality.
```{r}
ggplot(
  spotify_top_charts_22,
  aes(
    x = danceability,
    fill = factor(mode)
  )
) + geom_histogram() + labs(
  title = "Does the modality affect danceability?",
  x = "Danceability score",
  fill = "mode"
) + theme_minimal()
```

    What do you notice in the histogram? Are there general trends across
    modalities or clear differences?
    
There is no clear trend visible, which suggests the independence of modality and danceability.

<!-- -->

    Include a the full [list of
    citations](https://bookdown.org/yihui/rmarkdown-cookbook/bibliography.html#include-appendix-after-bibliography)
    under a level-1 heading "References" including the details of your
    citation. Insert this list of references before the heading
    `Supplementary Materials`.

# References

<div id="refs">
@ggplot2
</div>